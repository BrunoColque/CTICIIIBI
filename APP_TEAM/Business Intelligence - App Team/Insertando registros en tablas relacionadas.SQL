
-- INSERTANDO DESDE TABLAS TEMPORALES

INSERT INTO Ubigeo_F (COD_UBIGEO,DES_DEPARTAMENTO,DES_PROVINCIA,DES_DISTRITO,COD_CODIGO,
DES_DISTRITO_DET,FLG_ZONA,DES_CENTROSNEGOCIO,DES_DISTRITO_AGG,FLG_CIUDAD)
SELECT TRIM(UBIGEO),TRIM(DEPARTAMENTO),TRIM(PROVINCIA),TRIM(DISTRITO),TRIM(CODIGO),
TRIM(DISTRITO_DET),TRIM(FLGZONA),TRIM(CENTROSNEGOCIO),TRIM(DISTRITO_AGG),TRIM(FLGCIUDAD) FROM UbigeoS;

COMMIT;

INSERT INTO Bancos_F(COD_ENTIDAD,DES_BANCO,DES_BAN_NCORTO,DES_TIPO_ENTIDAD,
DES_TIPO_COMPETENCIA,DES_TIPO_COMPETENCIA2)
SELECT TRIM(CODEMPRE),TRIM(BANCO),TRIM(BNK),TRIM(TIPO),
TRIM(TIPOCOMPETENCIA),TRIM(TIPOCOMPETENCIA2) FROM Bancos;

COMMIT;

INSERT INTO ONPE_F(COD_NUMDOC,COD_DIGVER,DESC_GRPVOT,COD_UBIGEO,APPATERNO,
APMATERNO,NOMBRES,FECNAC,FLG_SEXO)
SELECT TRIM(NUMDOC),
TRIM(DIGVER),
TRIM(GRPVOT),
TRIM(UBIGEO),
TRIM(APPATERNO),
TRIM(APMATERNO),
TRIM(NOMBRES),
TO_DATE(FECNAC, 'yyyymmdd'),
TRIM(SEXO) FROM ONPE

commit;

--INSERTANDO EN TABLA ONPE_F LOS NUMERO DE DOCUMENTO DE CLIENTES QUE NO EXISTIAN   

INSERT INTO ONPE_F(COD_NUMDOC,DESC_GRPVOT,APPATERNO,APMATERNO,FECNAC)
SELECT TRIM(DOC_IDENTIDAD),'0','NN','NN',TO_DATE('19000101','yyyymmdd') FROM (
SELECT DISTINCT(DOC_IDENTIDAD) FROM Clientes WHERE DOC_IDENTIDAD IS NOT NULL
MINUS
SELECT DISTINCT(COD_NUMDOC) FROM ONPE_F);


INSERT INTO Clientes_F(PERIODO,COD_SBS_CLI,FEC_REPORTE,TIP_DOC_TRI,RUC,TIP_DOC_IDE,COD_NUMDOC,
TIP_PERSONA,TIP_EMPRESA,CAN_EMPRESA,DEU_CALIF0,DEU_CALIF1,DEU_CALIF2,DEU_CALIF3,
DEU_CALIF4,RAZ_SOC_O_AP,APE_MATERNA,APE_CASADA,NOMBRE1,NOMBRE2)
select TRIM(PERIODO),TRIM(COD_SBS_CLI),TO_DATE(FEC_REPORTE,'yyyymmdd'),TRIM(TIP_DOC_TRI),TRIM(RUC),TRIM(TIP_DOC_IDE),TRIM(DOC_IDENTIDAD),
TRIM(TIP_PERSONA),TRIM(TIP_EMPRESA),TRIM(CAN_EMPRESA),
TO_NUMBER (REPLACE (DEU_CALIF0, '.', ',')),
TO_NUMBER (REPLACE (DEU_CALIF1, '.', ',')),
TO_NUMBER (REPLACE (DEU_CALIF2, '.', ',')),
TO_NUMBER (REPLACE (DEU_CALIF3, '.', ',')),
TO_NUMBER (REPLACE (DEU_CALIF4, '.', ',')),
TRIM(RAZ_SOC_O_AP),TRIM(APE_MATERNA),TRIM(APE_CASADA),TRIM(NOMBRE1),TRIM(NOMBRE2) from Clientes


COMMIT;

INSERT INTO DEUDAS_F (IDDEUDA,
PERIODO,
COD_SBS_CLI,
COD_EMPRESA,
TIP_CREDITO,
COD_CUENTA,
CONDICION,
SALDO,
CLASIFICACION)     
SELECT customer_id.nextval,
TRIM(PERIODO),
TRIM(COD_SBS_CLI),
Lpad(COD_EMPRESA, 5, '0'),
TRIM(TIP_CREDITO),
TRIM(COD_CUENTA),
TRIM(CONDICION),
TO_NUMBER (REPLACE (SALDO, '.', ',')),
TRIM(CLASIFICACION)
FROM DEUDAS

-- INSERTANDO EN LA TABLA BANCOS REGISTROS DE DEUDAS (CODIGO DE BANCOS) QUE NO EXISTIAN 

INSERT INTO bancos_f(COD_ENTIDAD,DES_BANCO,DES_BAN_NCORTO,DES_TIPO_ENTIDAD,DES_TIPO_COMPETENCIA,DES_TIPO_COMPETENCIA2)
SELECT TRIM(COD_EMPRESA),COD_EMPRESA,COD_EMPRESA,COD_EMPRESA,COD_EMPRESA,COD_EMPRESA FROM (
SELECT distinct Lpad(COD_EMPRESA, 5, '0') as COD_EMPRESA FROM DEUDAS WHERE COD_EMPRESA IS NOT NULL
MINUS
SELECT DISTINCT(cod_entidad) FROM bancos_f);
